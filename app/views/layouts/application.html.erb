<!DOCTYPE html>
<html class="no-js">
  <head>
    <meta charset="UTF-8" />
    <%= csrf_meta_tags %>
    <title><%= @title || 'Movi.im' %></title>
    <%= stylesheet_link_tag 'application' %>
    <% if ios? and Rails.env.development? %><%= javascript_include_tag 'livereload' %><% end %>
  </head>
  
  <body class="<%= body_class ? body_class : 'default' %>">
    <%= javascript_include_tag 'modernizr' %>
    <script>
      Modernizr.addTest('inputsearch', function() {
        return Modernizr.inputtypes.search && navigator.userAgent.indexOf('Firefox') < 0
      })
    </script>
    
    <header>
      <h1><a href="/">movi.im</a></h1>
    
      <nav>
        <p>
          <% if logged_in? %><%= link_to 'Logout', logout_path %> âˆ™<% end %>
          <%= link_to 'About', about_path %>
        </p>

        <% if logged_in? %>
          <p><%= username_with_icon(current_user) %></p>
        <% elsif Movies.offline? %>
          <p><%= link_to 'Instalogin!', instant_login_path %></p>
        <% else %>
          <p class="login">Login with
            <%= link_to twitter_login_path do %><%= twitter_icon(nil) %> <span>Twitter</span><% end %>
            or
            <%= link_to facebook_login_path do %><%= facebook_icon(nil) %> <span>Facebook</span><% end %>
          </p>
        <% end %>

      </nav>
    </header>
    
    <% if flash[:warning] %>
      <p class="warning"><%= flash[:warning] %></p>
    <% end %>
      
    <%= form_tag root_path, :method => 'get' do %>
      <div>
        <%= text_field_tag :q, @query, :type => 'search', :results => '5', :placeholder => 'search movies by title' %>
        <%= submit_tag "search", :name => nil %>
      </div>
    <% end %>
      
    <%= yield %>
    
    <script type="text/javascript">
      if (!/\.dev$|local/.test(location.host)) (function() {
        var t = document.createElement('script'); t.type = 'text/javascript'; t.async = true;
        t.id = 'gauges-tracker'; t.setAttribute('data-site-id', '4e1d99d1f5a1f57523000004');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(t, s);
      })();
    </script>
    <%= javascript_include_tag 'application' %>
  </body>

</html>
